# Промежуточный веб-сервер для программы Libre Hardware Monitor

Программа [Libre Hardware Monitor](https://github.com/LibreHardwareMonitor/LibreHardwareMonitor) умеет создавать веб-сервер с JSON с информацией о различных параметрах компьютера, таких как температура, загрузка и т. д. <br> 
Единственная проблема заключается в том, что файл получается очень большим, и микроконтроллерам, например, таким как ESP, сложно его обработать. <br> 
Каких-то возможностей существенно уменьшить вывод программы я не нашел, и эта мини-программа призвана исправить это недоразумение, создавая промежуточный веб-сервер, который будет отображать только необходимые параметры. <br> 
Соответственно, для работы необходимо, чтобы веб-сервер Libre Hardware Monitor был запущен тоже.


### Возможности программы
+ Запускает промежуточный веб-сервер с отфильтрованными JSON данными на основе данных из сервера LHM.
+ Формирует путь до параметра в JSON LHM.
+ На основе введённых данных формирует скетч для ESP микроконтроллеров в среде Arduino.
+ Формирует переменные для вставки в код.
+ Максимальное количество параметров ограничено 50-ю. Цифра взята "с потолка", в коде можно увеличить, если будете собирать свой exe.

По умолчанию сервер запускается на http://your_ip:5001/filtered_data. <br>
Чтобы получить доступ извне, нужно добавить правило в брандмауэр и разрешить входящие соединения на порту 5001 (по умолчанию).<br>
[видео демонстрация запуска сервера и примера на ESP32](https://youtu.be/Xa8a85xxho4)

### Версии 
+ 0.8 beta
  + добавил кнопку автозапуска
    + при активации будет создавать задачу в планировщике на запуск приложения при входе в систему
  + если нажать закрыть в трее, то закроется программа и остановится сервер
  + при старте сервера проверяет запущен ли сервер LHM
  + если сервер не запущен и нажать на крестик то программа закроется, но если сервер запущен то свернется в трей
  + 



## Для работы нужно
+ Запустить сервер в программе Libre Hardware Monitor.
+ Сформировать JSON пути до выбранных параметров (см. инструкцию ниже).
+ Добавить необходимое количество параметров и сохранить их (сохранятся в paths.json в той же папке, что и программа).
+ Локальный IP адрес формируется программой. При необходимости можно изменить и нажать "Сохранить" (сохранятся в settings.json).
+ Если нужно сформировать скетч, то нужно выбрать тип данных,логин и пароль от Wi-Fi можно оставить пустыми и потом ввести в скетче.
+ Нажать кнопку "Запустить".
+ Сервер запустится и если вы разрешили входящие на порте 5001 то будет доступен для устройств из локальной сети

## Некоторые особенности
Программа тестировалась на Windows 11 на одном компьютере, поэтому возможны некоторые недокументированные фичи
+ Сервер запускается сразу, но иногда доступ к нему получают устройства в сети не сразу. Хз от чего это зависит, если не отвечает, надо подождать. А пока ждете, проверить, добавили ли правило в брандмауэр.
Если всё же такое произошло, нужно завершить процесс в диспетчере задач, а уже потом открывать новое окно программы.
+ Если не реагирует на кнопку "Остановить", нажмите на "Открыть" напротив URL сервера или обновите страницу сервера, если он открыт.
+ Если отредактировать имя параметра и нажать сохранить, то создаться новый параметр с новым именем, сатарый не удалится 

## Формирование путей
JSON файл программы LHM очень большой, и разобраться в нём очень сложно. Но для упрощения процесса есть ряд инструментов:
+ Делайте окно сервера поверх всех окон, нажав на чекбокс.
+ Нажмите "Открыть" напротив LHM URL. Откроется веб-сервер LHM (если он запущен), и копируйте все данные, которые там есть.
+ Далее перейдите на сайт [jsonformatter.org](https://jsonformatter.org/json-parser) (ссылка есть в окне программы).
+ Вставьте в левое поле скопированные данные и подождите, когда сайт обработает данные.
+ Ищите нужный параметр в окне справа, нажмите на его значение. Вверху отобразится путь до него, который нужно аккуратно скопировать.
Получиться должно что-то типа такого: ```Children►0►Children►3►Children►6►Children►0►Value``` <br>
+ Нажмите кнопку "Добавить параметр" и вставьте этот путь в поле "Путь в LHM". Введите имя параметра, выберите тип данных и нажмите "Сохранить".
+ Параметр сохранен в файле paths.json. 
+ Все это можно проделывать и при запущенном сервере - данные в нем будут обновляться.

<br> Дальнейшая работа с ним такая же, как и с обычным сервером LHM. Только не надо настраивать фильтры, и пути до параметров будут короче.
[Здесь](https://dzen.ru/a/ZFaVALzPNRycfvjs?ysclid=m7901ppl29114638609) более подробное описание запуска сервера в LHM.

![Снимок экрана 2025-02-19 012342](https://github.com/user-attachments/assets/48d1ed87-aced-430d-9cf2-576cd555e976)

## Запуск и сборка exe файла
+ Для запуска скрипта или сборки exe файла необходим [Python](https://www.python.org/downloads/). Я тестировал на версии 3.13.
+ После установки Python, перейдите в папку, где расположен скрипт.
+ Правая кнопка -> открыть в терминале -> скопировать команду -> Enter.
+ Кириллицы в пути лучше избегать.
+ В принципе, то же самое делает батник start, если расположить его в одной папке со скриптом.

Но перед запуском: <br>
установите библиотеки<br>
```pip install Flask requests tkinter```

Запуск скрипта:<br>
```python 1WEB_SERVER_for_LHM.py```

Сборка exe - иконка должна лежать в той же папке, где и скрипт:<br>
```pyinstaller --onefile --windowed --icon=icon.ico WEB_SERVER_for_LHM.py```

Собирается exe-шник в папке dist. 
Рядом с exe, в ту же папку, нужно положить все файлы иконок.<br> 


